<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Router  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="Router  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> 0.4.0 Docs</a> (83% documented)</p>
        <p class="header-right"><a href="https://github.com/hummingbird-project/hummingbird"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" />
        Router  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="encoding-and-decoding.html">Encoding and Decoding</a>
              </li>
              <li class="nav-group-task">
                <a href="error-handling.html">Error Handling</a>
              </li>
              <li class="nav-group-task">
                <a href="extending-hummingbird.html">Extending Hummingbird</a>
              </li>
              <li class="nav-group-task">
                <a href="middleware.html">Middleware</a>
              </li>
              <li class="nav-group-task">
                <a href="router.html">Router</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/HBDateCache.html">HBDateCache</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/HBApplication.html">HBApplication</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/HBApplication/EventLoopStorage.html">– EventLoopStorage</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/HBRequest.html">HBRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/HBRequest/ResponsePatch.html">– ResponsePatch</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/HBResponse.html">HBResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/JSONDecoder.html">JSONDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/JSONEncoder.html">JSONEncoder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/HBCacheControl.html">HBCacheControl</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCacheControl/Value.html">– Value</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCookie.html">HBCookie</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCookie/SameSite.html">– SameSite</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCookie/Properties.html">– Properties</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCookies.html">HBCookies</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBDateResponseMiddleware.html">HBDateResponseMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBFileIO.html">HBFileIO</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBFileMiddleware.html">HBFileMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/URLEncodedFormDecoder.html">URLEncodedFormDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/URLEncodedFormDecoder/DateDecodingStrategy.html">– DateDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/URLEncodedFormEncoder.html">URLEncodedFormEncoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/URLEncodedFormEncoder/DateEncodingStrategy.html">– DateEncodingStrategy</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='router' class='heading'>Router</h1>

<p>The router: <code>HBApplication.router</code> directs requests to their handlers based on the contents of their path. The router that comes with Hummingbird uses a Trie based lookup. Routes are added using the function <code>on</code>. You provide the URI path, the method and the handler function. Below is a simple route which returns &ldquo;Hello&rdquo; in the body of the response.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">HBApplication</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">on</span><span class="p">(</span><span class="s">"/hello"</span><span class="p">,</span> <span class="nv">method</span><span class="p">:</span> <span class="o">.</span><span class="kt">GET</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span> <span class="k">in</span>
    <span class="k">return</span> <span class="s">"Hello"</span>
<span class="p">}</span>
</code></pre>

<p>If you don&rsquo;t provide a path then the default is for it to be &ldquo;/&rdquo;.</p>
<h2 id='methods' class='heading'>Methods</h2>

<p>There are shortcut functions for common HTTP methods. The above can be written as</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">HBApplication</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"/hello"</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span> <span class="k">in</span>
    <span class="k">return</span> <span class="s">"Hello"</span>
<span class="p">}</span>
</code></pre>

<p>There are shortcuts for <code>put</code>, <code>post</code>, <code>head</code>, <code>patch</code> and <code>delete</code> as well.</p>
<h2 id='response-generators' class='heading'>Response generators</h2>

<p>Route handlers are required to return either a type conforming to the <code>HBResponseGenerator</code> protocol or an <code>EventLoopFuture</code> of a type conforming to <code>HBResponseGenerator</code>. An <code>EventLoopFuture</code> is an object that will fulfilled with their value at a later date in an asynchronous manner. The <code>HBResponseGenerator</code> protocol requires an object to be able to generate an <code>HBResponse</code>. For example <code>String</code> has been extended to conform to <code>HBResponseGenerator</code> by returning an <code>HBResponse</code> with status <code>.ok</code>,  a content-type header of <code>text-plain</code> and a body holding the contents of the <code>String</code>. </p>
<pre class="highlight swift"><code><span class="c1">/// Extend String to conform to ResponseGenerator</span>
<span class="kd">extension</span> <span class="kt">String</span><span class="p">:</span> <span class="kt">HBResponseGenerator</span> <span class="p">{</span>
    <span class="c1">/// Generate response holding string</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">response</span><span class="p">(</span><span class="n">from</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">HBRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">HBResponse</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">buffer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">allocator</span><span class="o">.</span><span class="nf">buffer</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kt">HBResponse</span><span class="p">(</span><span class="nv">status</span><span class="p">:</span> <span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="nv">headers</span><span class="p">:</span> <span class="p">[</span><span class="s">"content-type"</span><span class="p">:</span> <span class="s">"text/plain; charset=utf-8"</span><span class="p">],</span> <span class="nv">body</span><span class="p">:</span> <span class="o">.</span><span class="nf">byteBuffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In addition to <code>String</code> <code>ByteBuffer</code>, <code>HTTPResponseStatus</code> and <code>Optional</code> have also been extended to conform to <code>HBResponseGenerator</code>.</p>

<p>It is also possible to extend <code>Codable</code> objects to generate <code>HBResponses</code> by conforming these objects to <code>HBResponseEncodable</code>. The object will use <code>HBApplication.encoder</code> to encode these objects. If an object conforms to <code>HBResponseEncodable</code> then also so do arrays of these objects and dictionaries.</p>
<h2 id='parameters' class='heading'>Parameters</h2>

<p>You can extract parameters out of the URI by prefixing the path with a colon. This indicates that this path section is a parameter. The parameter name is the string following the colon. You can get access to the parameters extracted from the URI with <code>HBRequest.parameters</code>. If there are no URI parameters in the path, accessing <code>HBRequest.parameters</code> will cause a crash, so don&rsquo;t use it if you haven&rsquo;t specified a parameter in the route path. This example extracts an id from the URI and uses it to return a specific user. so &ldquo;/user/56&rdquo; will return user with id 56. </p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">HBApplication</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"/user/:id"</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">throw</span> <span class="kt">HBHTTPError</span><span class="p">(</span><span class="o">.</span><span class="n">badRequest</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nf">getUser</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">id</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>In the example above if I fail to access the parameter as an <code>Int</code> then I throw an error. If you throw an <code>HBHTTPError</code> it will get converted to a valid HTTP response.</p>
<h2 id='groups' class='heading'>Groups</h2>

<p>Route handlers can be grouped together in a <code>HBRouterGroup</code>.  These allow for you to prefix a series of routes with the same path and more importantly apply middleware to only those routes. The example below is a group that includes five handlers all prefixed with the path &ldquo;/todos&rdquo;.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">HBApplication</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="nf">group</span><span class="p">(</span><span class="s">"/todos"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">put</span><span class="p">(</span><span class="nv">use</span><span class="p">:</span> <span class="n">createTodo</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="nv">use</span><span class="p">:</span> <span class="n">listTodos</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">":id"</span><span class="p">,</span> <span class="n">getTodo</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">patch</span><span class="p">(</span><span class="s">":id"</span><span class="p">,</span> <span class="n">editTodo</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="s">":id"</span><span class="p">,</span> <span class="n">deleteTodo</span><span class="p">)</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://github.com/adam-fowler" target="_blank" rel="external">Adam Fowler</a>. All rights reserved. (Last updated: 2021-02-25)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
