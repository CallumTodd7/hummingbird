<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Error Handling  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="Error Handling  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> 0.8.1 Docs</a> (82% documented)</p>
        <p class="header-right"><a href="https://github.com/hummingbird-project/hummingbird"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" />
        Error Handling  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="encoding-and-decoding.html">Encoding and Decoding</a>
              </li>
              <li class="nav-group-task">
                <a href="error-handling.html">Error Handling</a>
              </li>
              <li class="nav-group-task">
                <a href="extending-hummingbird.html">Extending Hummingbird</a>
              </li>
              <li class="nav-group-task">
                <a href="middleware.html">Middleware</a>
              </li>
              <li class="nav-group-task">
                <a href="router.html">Router</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/HBApplication.html">HBApplication</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBApplication/Configuration.html">– Configuration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBApplication/EventLoopStorage.html">– EventLoopStorage</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBApplication/EventLoopStorageMap.html">– EventLoopStorageMap</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBApplication/HTTPResponder.html">– HTTPResponder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBDateCache.html">HBDateCache</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBMiddlewareGroup.html">HBMiddlewareGroup</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBRequest.html">HBRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBRequest/Context.html">– Context</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBRequest/ResponsePatch.html">– ResponsePatch</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HBResponse.html">HBResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/HBBodyCollation.html">HBBodyCollation</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ByteBuffer.html">ByteBuffer</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Dictionary.html">Dictionary</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/EventLoopFuture.html">EventLoopFuture</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/HTTPResponseStatus.html">HTTPResponseStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Optional.html">Optional</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Set.html">Set</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Unicode.html">Unicode</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Unicode/Scalar.html">– Scalar</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/HBExtensible.html">HBExtensible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBMiddleware.html">HBMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBRequestDecodable.html">HBRequestDecodable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBRequestDecoder.html">HBRequestDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBResponder.html">HBResponder</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:11Hummingbird17HBResponseCodableP">HBResponseCodable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBResponseEncodable.html">HBResponseEncodable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBResponseEncoder.html">HBResponseEncoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBResponseGenerator.html">HBResponseGenerator</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBRouteHandler.html">HBRouteHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBRouter.html">HBRouter</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/HBRouterMethods.html">HBRouterMethods</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/HBCORSMiddleware.html">HBCORSMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCORSMiddleware/AllowOrigin.html">– AllowOrigin</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBCallbackResponder.html">HBCallbackResponder</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBEnvironment.html">HBEnvironment</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBExtensions.html">HBExtensions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBLogRequestsMiddleware.html">HBLogRequestsMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBMediaType.html">HBMediaType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBMediaType/Category.html">– Category</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBMetricsMiddleware.html">HBMetricsMiddleware</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBParameters.html">HBParameters</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBParser.html">HBParser</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBParser/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBParser/Iterator.html">– Iterator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBRouterGroup.html">HBRouterGroup</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBURL.html">HBURL</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/HBURL/Scheme.html">– Scheme</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='error-handling' class='heading'>Error Handling</h1>

<p>If a middleware or route handler throws an error the server needs to know how to handle this. If the server does not know how to handle the error then the only thing it can return to the client is a status code of 500 (Internal Server Error). This is not overly informative.</p>
<h2 id='hbhttperror' class='heading'>HBHTTPError</h2>

<p>Hummingbird uses the Error object <code>HBHTTPError</code> throughout its codebase. The server recognises this and can generate a more informative response for the client from it. The error includes the status code that should be returned and a response message if needed. For example </p>
<pre class="highlight swift"><code><span class="n">app</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"user"</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span> <span class="o">-&gt;</span> <span class="kt">User</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">userId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">uri</span><span class="o">.</span><span class="n">queryParameters</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">HBHTTPError</span><span class="p">(</span><span class="o">.</span><span class="n">badRequest</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"Invalid user id"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p>The <code>HBHTTPError</code> generated here will be recognised by the server and it will generate a status code 400 (Bad Request) with the body &ldquo;Invalid user id&rdquo;.</p>

<p>In the situation where you have a route that returns an <code>EventLoopFuture</code> you are not allowed to throw an error so you have to return a failed <code>EventLoopFuture</code>. Hummingbird provides a shortcut here for you <code>request.failure</code>. It can be used as follows</p>
<pre class="highlight swift"><code><span class="n">app</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"user"</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span> <span class="o">-&gt;</span> <span class="kt">EventLoopFuture</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">userId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">uri</span><span class="o">.</span><span class="n">queryParameters</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="nv">as</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="o">.</span><span class="n">badRequest</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"Invalid user id"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre>
<h2 id='hbhttpresponseerror' class='heading'>HBHTTPResponseError</h2>

<p>The server knows how to respond to a <code>HBHTTPError</code> because it conforms to protocol <code>HBHTTPResponseError</code>. You can create your own <code>Error</code> object and conform it to <code>HBHTTPResponseError</code> and the server will know how to generate a sensible error from it. The example below is a error class that outputs an error code in the response headers.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">MyError</span><span class="p">:</span> <span class="kt">HBHTTPResponseError</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">status</span><span class="p">:</span> <span class="kt">HTTPResponseStatus</span><span class="p">,</span> <span class="nv">errorCode</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">self</span><span class="o">.</span><span class="n">errorCode</span> <span class="o">=</span> <span class="n">errorCode</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">errorCode</span><span class="p">:</span> <span class="kt">String</span>

    <span class="c1">// required by HBHTTPResponseError protocol</span>
    <span class="k">let</span> <span class="nv">status</span><span class="p">:</span> <span class="kt">HTTPResponseStatus</span>
    <span class="k">var</span> <span class="nv">headers</span><span class="p">:</span> <span class="kt">HTTPHeaders</span> <span class="p">{</span> <span class="p">[</span><span class="s">"error-code"</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">errorCode</span><span class="p">]</span> <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">body</span><span class="p">(</span><span class="nv">allocator</span><span class="p">:</span> <span class="kt">ByteBufferAllocator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ByteBuffer</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="https://github.com/adam-fowler" target="_blank" rel="external">Adam Fowler</a>. All rights reserved. (Last updated: 2021-04-07)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
